---
# Wait for NPM service to be ready
# This ensures the web interface is accessible before attempting configuration
# Now using the common wait_for_swarm_service task for consistency

- name: Wait for NPM service using common task
  ansible.builtin.include_tasks: tasks/common/wait_for_swarm_service.yml
  vars:
    service_name: "{{ npm_config_service_name }}"
    wait_host: "{{ hostvars[npm_config_target_node]['ansible_host'] }}"
    wait_port: "{{ npm_config_web_port }}"
    wait_delay: "{{ npm_config_readiness_delay }}"
    wait_timeout: "{{ npm_config_readiness_timeout }}"
    wait_initial_pause: 15
    wait_path: "/api/schema"
    wait_http_status_codes: [200, 401]  # 401 is OK before authentication
    wait_swarm_manager: "{{ npm_config_swarm_manager }}"
    wait_display_results: true
