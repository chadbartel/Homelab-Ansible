---
# Pi-hole post-deployment configuration tasks
# Using the pihole_config role for idempotent, modular configuration

- name: Wait for Pi-hole service to be ready
  ansible.builtin.include_role:
    name: pihole_config
    tasks_from: wait_for_service
  vars:
    target_host: "{{ ansible_host }}"

- name: Configure Pi-hole adlists (block lists)
  ansible.builtin.include_role:
    name: pihole_config
    tasks_from: adlists

- name: Configure custom DNS entries for local domains
  ansible.builtin.include_role:
    name: pihole_config
    tasks_from: custom_dns

- name: Configure dnsmasq settings
  ansible.builtin.include_role:
    name: pihole_config
    tasks_from: dnsmasq

- name: Display Pi-hole access information
  ansible.builtin.debug:
    msg: |
      ‚úÖ Pi-hole is configured successfully!
      
      üåê Access Information (via Swarm ingress - accessible from ANY node):
      Web Interface: http://{{ ansible_host }}:{{ pihole_web_port }}/admin
      DNS Server: {{ ansible_host }}:53
      Password: {{ pihole_web_password }}
      
      üìã Configuration:
      - {{ pihole_config_adlists | default([]) | length }} block lists configured
      - {{ pihole_config_custom_dns_entries | default([]) | length }} custom DNS entries
      - {{ pihole_config_dnsmasq_settings | default([]) | length }} dnsmasq settings
      - Running on node: {{ pihole_target_host }}