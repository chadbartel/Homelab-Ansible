---
# Global variables for homelab deployment

# Admin user configuration
admin_user: thatsmidnight
admin_email: "me@chadbartel.com"
admin_password: "{{ vault_admin_password }}"
admin_ssh_key_public: "{{ vault_admin_ssh_key_public }}"

# Bootstrap configuration
ansible_version: "2.18.6"
x86_image_link: "https://mirror.pnl.gov/releases/noble/ubuntu-24.04.2-live-server-amd64.iso"
arm_image_link: "https://downloads.raspberrypi.org/raspios_lite_arm64/archive/2025-05-13-08:03/"
dietpi_image_link: "https://dietpi.com/downloads/images/DietPi_RPi234-ARMv8-Bookworm.img.xz"
stack_deployer_backend: "direct"  # Default backend for stack deployment (can be overridden at runtime)

# Service passwords (should be stored in vault)
portainer_admin_password: "{{ vault_portainer_admin_password }}"
npm_admin_password: "{{ vault_npm_admin_password }}"
openvpn_admin_password: "{{ vault_openvpn_admin_password }}"

# Portainer configuration
portainer_agent_secret: "{{ vault_portainer_agent_secret }}"

# OpenVPN configuration
openvpn_activation_key: "{{ vault_openvpn_activation_key }}"
openvpn_thatsmidnight_password: "{{ vault_openvpn_thatsmidnight_password }}"
openvpn_tyramail_password: "{{ vault_openvpn_tyramail_password }}"
openvpn_hostname: "{{ vault_openvpn_hostname }}"

# OpenVPN Config Role Variables
openvpn_config_service_name: "vpn-stack_openvpn-as"
openvpn_config_swarm_manager: "pi4_01"
openvpn_config_target_host: "midnight-laptop"
openvpn_config_admin_user: "{{ openvpn_container_name }}"
openvpn_config_admin_password: "{{ vault_openvpn_admin_password }}"
openvpn_config_server_hostname: "{{ vault_openvpn_hostname }}"
openvpn_config_activation_key: "{{ vault_openvpn_activation_key }}"
openvpn_config_users:
  - username: "thatsmidnight"
    password: "{{ vault_openvpn_thatsmidnight_password }}"
    autologin: true
  - username: "tyramail"
    password: "{{ vault_openvpn_tyramail_password }}"
    autologin: true

# Jellyfin configuration
jellyfin_thatsmidnight_password: "{{ vault_jellyfin_thatsmidnight_password }}"
jellyfin_enable_hw_accel: false  # Hardware acceleration not supported in Docker Swarm (device cgroups limitation)
jellyfin_target_host: "midnight-laptop"  # The specific host for Jellyfin (must match Swarm node hostname)
jellyfin_image: "jellyfin/jellyfin:10"  # Official Jellyfin image
jellyfin_container_name: "jellyfin"
jellyfin_host_port: 8096
jellyfin_memory_limit: "4GB"  # Container memory limit
jellyfin_media_mount_path: "/mnt/ssd_media"  # Host path where media is stored
jellyfin_container_media_path: "/media"  # Path inside container where media is mounted
jellyfin_external_url: "http://{{ jellyfin_container_name }}.{{ local_domain }}"  # External URL via proxy
jellyfin_epg_image: "alpine:3.23"
jellyfin_epg_url: "https://epgshare01.online/epgshare01/epg_ripper_US2.xml.gz"
jellyfin_epg_schedule: "0 1 * * *"  # Cron format: 1:00 AM daily

# Jellyfin Config Role Variables
jellyfin_config_service_name: "jellyfin-stack_jellyfin"
jellyfin_config_swarm_manager: "pi4_01"
jellyfin_config_target_node: "lenovo_server"
jellyfin_config_web_port: 8096
jellyfin_config_admin_user: "{{ admin_user }}"
jellyfin_config_admin_password: "{{ vault_jellyfin_thatsmidnight_password }}"
jellyfin_config_api_key_app_name: "ansible_automation"
jellyfin_config_libraries:
  - name: "Music"
    type: "music"
    paths:
      - "/media/music"
    refresh_on_create: true
  - name: "Movies"
    type: "movies"
    paths:
      - "/media/movies"
    refresh_on_create: true
  - name: "Concerts"
    type: "movies"
    paths:
      - "/media/concerts"
    refresh_on_create: true

# NGINX Proxy Manager Config Role Variables
npm_service_name: "npm-stack_npm"
npm_swarm_manager: "pi4_01"
npm_target_node: "lenovo_server"

# Pi-hole configuration
pihole_config_path: "/opt/pihole/etc-pihole"
pihole_web_password: "{{ vault_pihole_admin_password }}"
block_lists: "https://v.firebog.net/hosts/lists.php?type=tick"
pihole_data_path: "/opt/pihole"
pihole_web_port: 8081  # Port for Pi-hole web interface
pihole_dns_port: 80  # Port for Pi-hole DNS service
pihole_target_host: "midnight-laptop"  # The specific host for Pi-hole (must match Swarm node hostname)

# Pi-hole Config Role Variables
pihole_config_service_name: "pihole-stack_pihole"
pihole_config_swarm_manager: "pi4_01"
pihole_config_target_node: "lenovo_server"

# Custom DNS entries for local services
pihole_config_custom_dns_entries:
  - ip: "{{ manager_node_ip }}"
    hostname: "{{ pihole_container_name }}.{{ local_domain }}"
  - ip: "{{ manager_node_ip }}"
    hostname: "{{ portainer_container_name }}.{{ local_domain }}"
  - ip: "{{ manager_node_ip }}"
    hostname: "{{ nginx_proxy_container_name }}.{{ local_domain }}"
  - ip: "{{ manager_node_ip }}"
    hostname: "{{ openvpn_container_name }}.{{ local_domain }}"

# Dnsmasq performance tuning
pihole_config_dnsmasq_settings:
  - "dns-forward-max=300"

# Note: pihole_config_adlists uses defaults from role (roles/pihole_config/defaults/main.yml)
# Override here if needed:
# pihole_config_adlists:
#   - url: "https://example.com/custom-list.txt"
#     comment: "Custom List"
#     enabled: true

# Docker Stacks Configuration for manager nodes
portainer_stacks:
  - name: npm-stack
    compose_template: npm-compose.yml.j2
  - name: pihole-stack
    compose_template: pihole-compose.yml.j2
  - name: vpn-stack
    compose_template: openvpn-compose.yml.j2
  - name: jellyfin-stack
    compose_template: jellyfin-compose.yml.j2

# NFS: Storage Host 192.168.1.12 (lenovo_server) exports /mnt/ssd_media to other nodes
nfs_storage_host_ip: "192.168.1.12"
nfs_export_path: "/mnt/ssd_media"
nfs_export_network: "192.168.1.0/24"
nfs_export_options: "rw,sync,no_subtree_check,all_squash,anonuid=1000,anongid=1000"
nfs_client_mount_path: "/mnt/ssd_media"
nfs_client_options: "rw,soft,intr,noatime,timeo=14,_netdev"
pihole_container_name: "pihole"
openvpn_container_name: "vpn"
portainer_container_name: "portainer"
nginx_proxy_container_name: "proxy"

# Network configuration
homelab_network: "192.168.2.0/24"
manager_node_ip: "192.168.1.10"
worker_node_ip1: "192.168.1.11"
worker_node_ip2: "192.168.1.12"
gateway_ip: "192.168.1.1"
local_domain: "chadbartel.duckdns.org"
proxy_host_port: 8181
pihole_host_port: 80
vpn_host_port: 943
portainer_host_port: 9443
ssl_certificate_id: 2  # Change this to 0 on initial deployment

# Miscellaneous
timezone: "America/Los_Angeles"

# Python virtual environment configuration
python_version: "3.11"  # Python version to use
python_venv_name: "homelab-ansible"  # Name of the virtual environment
python_venv_path: "/opt/{{ python_venv_name }}"  # Path to create the venv
python_packages:
  - docker  # Python Docker SDK
  - requests  # Often needed by Ansible modules
  - urllib3  # HTTP library
